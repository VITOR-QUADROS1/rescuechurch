<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mural — Igreja do Resgate</title>
  <meta name="theme-color" content="#10141E">
  <link rel="icon" href="logo.png">
  <link rel="stylesheet" href="style.css">

  <style>
    /* =========================
       MODAL (fixo, não invade página)
    ========================= */
    .img-modal[hidden] { display: none !important; }

    .img-modal{
      position: fixed;
      inset: 0;
      z-index: 9999;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 18px;
      background: rgba(0,0,0,.72);
      backdrop-filter: blur(6px);
    }

    /* Caixa do modal: elástica e sem cortes */
    .img-box{
      position: relative;
      width: auto;
      max-width: 96vw;
      max-height: 92vh;
      padding: 0;
      background: transparent;
      border: none;
      box-shadow: none;
      overflow: visible;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .img-box figure{ margin:0; width: 100%; display:flex; flex-direction:column; align-items:center; }

    /* Imagem no modal */
    .img-box img{
      display:block;
      width:auto;
      height:auto;
      max-width:96vw;
      max-height:90vh;
      object-fit:contain;
      border-radius:12px;
      background:#000;
    }

    /* Vídeo no modal */
    .img-box video{
      display:block;
      width:auto;
      height:auto;
      max-width:96vw;
      max-height:90vh;
      border-radius:12px;
      background:#000;
    }

    /* Legenda */
    .img-caption{
      margin-top:10px;
      padding:6px 10px;
      background:rgba(0,0,0,.55);
      border-radius:10px;
      text-align:center;
      color:#fff;
      max-width: 92vw;
    }

    /* Botão fechar (garante clique) */
    .img-close{
      position: absolute;
      right: 10px;
      top: 10px;
      width: 40px;
      height: 40px;
      border-radius: 999px;
      border: 0;
      cursor: pointer;
      font-size: 18px;
      line-height: 40px;
      color: #fff;
      background: rgba(0,0,0,.55);
      z-index: 10000;
    }

    /* =========================
       THUMB DO VÍDEO "TIPO YOUTUBE"
    ========================= */
    .gallery-item{
      position:relative;
      display:block;
    }

    .video-thumb{
      width:100%;
      height:100%;
      display:block;
      object-fit:cover;
    }

    .play-overlay{
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      pointer-events:none;
    }

    .play-badge{
      display:flex;
      align-items:center;
      gap:8px;
      padding:10px 14px;
      border-radius:999px;
      background: rgba(0,0,0,.55);
      color:#fff;
      font-size:14px;
      font-weight:600;
    }

    .play-tri{
      width:0;
      height:0;
      border-left:12px solid #fff;
      border-top:8px solid transparent;
      border-bottom:8px solid transparent;
    }
  </style>
</head>

<body>
  <!-- Topbar -->
  <header class="topbar">
    <a href="https://www.youtube.com/channel/UC11Km85MPiYbuPmG7Lz2Wjg" target="_blank" rel="noopener" class="brand-link">
      <div class="brand">
        <img src="logo.png" class="brand-logo" alt="Rescue Church">
        <span>Igreja do Resgate</span>
      </div>
    </a>
    <nav class="menu">
      <a href="../index.html#inicio">Início</a>
      <a href="../index.html#vdia">Versículo do Dia</a>
      <a href="../index.html#buscar">Buscar na Bíblia</a>
      <a href="../index.html#videos">Vídeos & Lives</a>
      <a href="mural.html" aria-current="page">Mural</a>
    </nav>
  </header>

  <main class="container">
    <section class="card section">
      <div class="section-head" style="text-align:center;">
        <h2>Mural da Comunidade</h2>
      </div>

      <div id="gallery" class="gallery-grid"></div>

      <p class="muted" style="margin-top:14px">
        Dica: clique numa foto/vídeo para ampliar · use as setas do teclado (← →) · ESC para fechar
      </p>

      <div style="margin-top:18px; text-align:right">
        <a href="../index.html" class="btn pill">Voltar ao início</a>
      </div>
    </section>
  </main>

  <!-- Modal de mídia -->
  <div id="imgModal" class="img-modal" hidden>
    <div class="img-box">
      <button class="img-close" aria-label="Fechar" type="button">✕</button>

      <figure>
        <img id="imgFull" src="" alt="" hidden />
        <video id="vidFull" controls playsinline preload="metadata" hidden></video>
        <figcaption id="imgCaption" class="img-caption"></figcaption>
      </figure>
    </div>
  </div>

  <script>
    // =========================
    // 1) LISTA DO MURAL
    // Para vídeo, coloque poster: "mural/SEU-THUMB.jpg"
    // =========================
    const GALLERY = [
      { src: "mural/quartas.jpg", title: "" },

      // VIDEO: troque/coloque seu thumbnail aqui (tipo youtube)
      { src: "mural/video.mp4", poster: "mural/video-thumb.jpg", title: "Culto — vídeo" },

      { src: "mural/sexta.jpeg", title: "" },
      { src: "mural/domingo.jpg", title: "" },
    ];

    function getExt(path) {
      const clean = String(path).split('?')[0].split('#')[0];
      const parts = clean.split('.');
      return (parts.length > 1 ? parts.pop() : '').toLowerCase();
    }
    function isVideoSrc(src) {
      const ext = getExt(src);
      return ['mp4', 'webm', 'ogg'].includes(ext);
    }

    // =========================
    // 2) Renderiza grid
    // Imagem => <img>
    // Vídeo  => thumbnail (poster) com overlay play
    // =========================
    const $grid = document.getElementById('gallery');

    $grid.innerHTML = GALLERY.map((item, i) => {
      const video = isVideoSrc(item.src);

      if (video) {
        const poster = item.poster || "";
        // Se não tiver poster, ainda mostra um bloco (melhor definir poster)
        return `
          <a href="${item.src}" class="gallery-item" data-index="${i}">
            <img class="video-thumb" src="${poster}" alt="${item.title || 'Vídeo'}" onerror="this.style.opacity=.25; this.alt='(adicione poster do vídeo)';">
            <div class="play-overlay">
              <div class="play-badge"><span class="play-tri"></span>Vídeo</div>
            </div>
            <div class="gallery-caption"></div>
          </a>
        `;
      }

      return `
        <a href="${item.src}" class="gallery-item" data-index="${i}">
          <img src="${item.src}" alt="${item.title || ''}">
          <div class="gallery-caption"></div>
        </a>
      `;
    }).join('');

    // =========================
    // 3) Modal: abre/fecha e navegação
    // =========================
    const $modal    = document.getElementById('imgModal');
    const $imgFull  = document.getElementById('imgFull');
    const $vidFull  = document.getElementById('vidFull');
    const $caption  = document.getElementById('imgCaption');
    const $closeBtn = $modal.querySelector('.img-close');

    let current = -1;

    function stopVideo() {
      try {
        $vidFull.pause();
        $vidFull.removeAttribute('src');
        $vidFull.load();
      } catch(e) {}
    }

    function showImage(src, title) {
      stopVideo();
      $vidFull.hidden = true;

      $imgFull.hidden = false;
      $imgFull.src = src;
      $imgFull.alt = title || '';
    }

    function showVideo(src, poster, title) {
      $imgFull.hidden = true;
      $imgFull.src = '';
      $imgFull.alt = '';

      $vidFull.hidden = false;
      $vidFull.src = src;

      if (poster) $vidFull.setAttribute('poster', poster);
      else $vidFull.removeAttribute('poster');

      $vidFull.load();

      // tenta dar play; em celular pode bloquear se não houver interação ou se não estiver permitido
      const p = $vidFull.play();
      if (p && typeof p.catch === 'function') p.catch(() => {});
    }

    function openModal(index) {
      current = index;
      const it = GALLERY[current];
      const title = it.title || '';

      $caption.textContent = title;
      $modal.hidden = false;

      if (isVideoSrc(it.src)) {
        showVideo(it.src, it.poster || "", title);
      } else {
        showImage(it.src, title);
      }
    }

    function closeModal() {
      $modal.hidden = true;
      $caption.textContent = '';
      $imgFull.src = '';
      $imgFull.alt = '';
      $imgFull.hidden = true;
      stopVideo();
      $vidFull.hidden = true;
      current = -1;
    }

    function nextItem() {
      if (!GALLERY.length) return;
      current = (current + 1) % GALLERY.length;
      openModal(current);
    }

    function prevItem() {
      if (!GALLERY.length) return;
      current = (current - 1 + GALLERY.length) % GALLERY.length;
      openModal(current);
    }

    // Click nos cards
    $grid.addEventListener('click', (ev) => {
      const a = ev.target.closest('a.gallery-item');
      if (!a) return;
      ev.preventDefault();
      const i = parseInt(a.getAttribute('data-index'), 10);
      if (!Number.isNaN(i)) openModal(i);
    });

    // X fecha (funciona)
    $closeBtn.addEventListener('click', (ev) => {
      ev.preventDefault();
      ev.stopPropagation();
      closeModal();
    });

    // Clique fora fecha (somente no backdrop)
    $modal.addEventListener('click', (ev) => {
      if (ev.target === $modal) closeModal();
    });

    // ESC e setas
    window.addEventListener('keydown', (ev) => {
      if ($modal.hidden) return;
      if (ev.key === 'Escape') closeModal();
      else if (ev.key === 'ArrowRight') nextItem();
      else if (ev.key === 'ArrowLeft')  prevItem();
    });
  </script>
</body>
</html>
